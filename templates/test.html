
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç—ã</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap –∏ Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .navbar-custom {
            background-color: #f8f9fa;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }

        .navbar-custom .user-info {
            font-size: 18px;
            font-weight: bold;
        }

        .navbar-custom .coins {
            font-size: 18px;
            color: #007bff;
        }

        .page-content {
            padding: 20px;
            min-height: 80vh;
        }

        .tabs-custom {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f8f9fa;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #e0e0e0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .tabs-custom .tab {
            text-align: center;
            flex: 1;
        }

        .tabs-custom .tab i {
            font-size: 24px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

<!-- –ù–∞–≤–±–∞—Ä -->
<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
        <div class="user-info">–°”ô–ª–µ–º, {{ username }}</div>
        <div class="coins">ü™ô {{ coin }}</div>
    </div>
</nav>

<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container page-content">
    <h1>–¢–µ—Å—Ç—ã</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, {{ username }}!</p>
    <!-- –í–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤ -->
</div>

<!-- –í–∫–ª–∞–¥–∫–∏ –≤–Ω–∏–∑—É -->
<div class="tabs-custom">
    <a href="/?username={{ username }}&coin={{ coin }}&telegram_id={{ telegram_id }}" class="tab">
        <i class="fas fa-book"></i>
        <span>–ú–æ–∏ —É—Ä–æ–∫–∏</span>
    </a>
    <a href="/test/?username={{ username }}&coin={{ coin }}&telegram_id={{ telegram_id }}" class="tab active-tab">
        <i class="fas fa-pencil-alt"></i>
        <span>–¢–µ—Å—Ç</span>
    </a>
    <a href="/city/?username={{ username }}&coin={{ coin }}&telegram_id={{ telegram_id }}" class="tab">
        <i class="fas fa-city"></i>
        <span>–ú–æ–π –≥–æ—Ä–æ–¥</span>
    </a>
    <a href="/ai/?username={{ username }}&coin={{ coin }}&telegram_id={{ telegram_id }}" class="tab">
        <i class="fas fa-microchip"></i>
        <span>AI_zhan</span>
    </a>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ Bootstrap –∏ Font Awesome -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF-—Ç–æ–∫–µ–Ω–∞ –∏–∑ cookies
    function getCSRFToken() {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, 10) === 'csrftoken=') {
                    cookieValue = decodeURIComponent(cookie.substring(10));
                    break;
                }
            }
        }
        return cookieValue;
    }


    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
    const params = new URLSearchParams(window.location.search);
    const username = params.get('username');
    const coin = params.get('coin');
    const telegram_id = params.get('telegram_id');

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å username –∏ coin
    document.getElementById('username').textContent = username;
    document.getElementById('coin').textContent = coin;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
    const backButton = document.getElementById('backButton');
    backButton.href = `/?username=${username}&coin=${coin}&telegram_id=${telegram_id}`;



    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    function submitTest(testId) {
        let correctAnswers = 0;
        const form = document.getElementById(`test${testId}Form`);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç—ã
        const answers = form.querySelectorAll('input[type="radio"]:checked');
        answers.forEach(answer => {
            if (answer.value === 'correct') {
                correctAnswers++;
            }
        });

        // –ï—Å–ª–∏ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
        if (correctAnswers === 2) {
            alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –≤–∞–º –¥–æ–±–∞–≤–ª–µ–Ω–æ 100 –∫–æ–∏–Ω–æ–≤.');
            updateCoins(100); // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–∏–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        } else {
            alert('–ù–µ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–∏–Ω–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    function updateCoins(amount) {
        const params = new URLSearchParams(window.location.search);
        const telegram_id = params.get('telegram_id');
        const csrfToken = getCSRFToken();  // –ü–æ–ª—É—á–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω

        if (telegram_id) {
            fetch('/update_coins/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,  // –î–æ–±–∞–≤–ª—è–µ–º CSRF-—Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏
                },
                body: JSON.stringify({
                    telegram_id: telegram_id,
                    coins: amount,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('coin').textContent = data.new_balance; // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                } else {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–∏–Ω–æ–≤:', data.message);
                }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
        }
    }
</script>


</body>
</html>
